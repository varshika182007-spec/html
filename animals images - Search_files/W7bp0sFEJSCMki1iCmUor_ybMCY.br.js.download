var __spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},SmartPreview;(function(n){function u(n){for(var u,r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];i&&i.config&&(u=i.config.ptnInstName||"",ri||Log&&Log.Log&&Log.Log.apply(Log,__spreadArray([n,p,u,!1],r,!1)))}function tt(n){u(w,ni,"Error",s,n)}function c(n){u(dt,s,n)}function yt(n){n&&Log&&Log.LogFilterFlare&&Log.LogFilterFlare([n])}function it(n,t){var r=sb_st(function(){r=null;var n="",f="";i&&i.inst&&(n=i.inst.ns||"",f=i.inst.k||"");u(gt,"HType",t,"AppNS",n,"K",f,"TS",sb_gt()+"")},n);return r}function ui(n){var i=n&&n.getAttribute("h"),t;if(i)return t=ti.exec(i),t&&t.length===3?{ns:t[1],k:t[2]}:void 0}function pt(t){var u,e;if(t){var f=t.hovTargetSel,i=t.hovTargetContSel,o=t.hovContId,s=t.mainImgSel;f&&i&&o&&s&&(u=_qs(i),!r[i]&&u&&(r[i]=t,u.setAttribute(y,i),e=_d.querySelectorAll(f),e.forEach(function(n){n.getAttribute(ii)||(sj_be(n,ot,rt),sj_be(_qs(t.imgLinkSel,n),kt,rt),sj_be(n,v,ft))})),typeof n.KapiService!="undefined"&&!h&&t.kapi&&(h=new n.KapiService(t.kapi)))}}function fi(n){delete r[n.hovTargetContSel];pt(n)}function l(){var t,n,i;sj_ue(_w,st,l);sj_evt.unbind(at,l);sj_ue(_w,ct,a);sj_ue(_w,lt,a);o();for(t in r)n=r[t],n&&(i=_d.querySelectorAll(n.hovTargetSel),i.forEach(function(n){sj_ue(n,ot,rt)}))}function rt(n){var e,h,t,c,l,a;(o(),e=sj_et(n),e)&&(h=e.closest("[".concat(y,"]")),t=h&&r[h.getAttribute(y)],t)&&(c=_qs('[data-hcid="'.concat(t.hovContId,'"]')),l=ei(e,t),l&&c)&&(a=t.imgLinkSel&&_qs(t.imgLinkSel,e),i={el:e,m:l,template:c,config:t,imgLink:a,inst:ui(a)},g=sb_st(function(){sj_ue(e,f,et);si(e);yt(t.ctnShownFlare);u(w,s,"ContainerShown")},t.crd||0),t.crd>0&&sj_be(e,f,et),d=it(500,"h"),b=it(2e3,"d2"),k=it(5e3,"d5"))}function ut(){if(t&&i){var r=[s,"ContainerClosed"],n=i.kapiData;n&&(r.push("HasKapiData",n.res?"1":"0"),r.push("Status",n.s+""),n.lt&&r.push("Latency",n.lt+""),n.res&&r.push("Modules","RS|"));u.apply(void 0,__spreadArray([w],r,!1))}o()}function ft(n){var i=t;i&&i.contains(n.relatedTarget)||ut()}function a(){t&&i&&(t.style.pointerEvents="none",o(),nt&&sb_ct(nt),nt=sb_st(function(){t&&(t.style.pointerEvents="auto")},100))}function et(){o()}function wt(){i&&i.config&&yt(i.config.ctnClkFlr)}function o(){if(i&&i.el&&sj_ue(i.el,f,et),t){sj_ue(t,f,ut);sj_ue(t,v,ft);sj_ue(t,ht,wt);try{t.parentElement.removeChild(t)}catch(n){tt("ContainerRemoveFailed")}}sb_ct(g);sb_ct(d);sb_ct(b);sb_ct(k);g=b=k=d=null;t=i=null}function ei(n,t){var r,u,f,e,i;if(!n)return null;if(r=_qs(t.mainImgSel,n),u=r===null||r===void 0?void 0:r.closest("a[m]"),r&&u){f=u.getAttribute("m");e=r.getAttribute("src");try{return i=JSON.parse(f),{thurl:e,title:i.t,domain:i.dm,imgUrl:i.url,domainUrl:i.purl,istk:i.istk,domainFid:i.favid,mid:i.mid,murl:i.murl}}catch(o){tt("NoMetadata")}}return null}function oi(n){if(i&&t&&n.url===i.m.thurl){i.kapiData=n;sj_appHTML(t,n.res);var r=_qs(".isp_nac",t);r&&(n.fc?r.classList.remove("isp_nac"):bt(r,"isp_anim",!0))}}function si(n){var r,o,et,ot,d,g,s,p,u,y,w,nt,tt,b,it,l,rt,k,a,st;n&&i&&i.el&&i.template&&(r=i.m,r&&r.thurl)&&(o=i.el.getBoundingClientRect(),t=i.template.cloneNode(!0),t)&&(et=o.left-vt,ot=o.top-vt,t.style.left=et+e,t.style.top=ot+e,t.style.maxWidth=o.width+e,d=!1,r.thurl&&(g=_qs(".isp_imgcont",t),s=sj_ce("img"),s.setAttribute("src",r.thurl),s.setAttribute("width",o.width+e),s.setAttribute("height",o.height+e),s.role="presentation",s.onclick=function(){c("ImageClick")},i.imgLink?(p=i.imgLink.cloneNode(),p.appendChild(s),g.appendChild(p),d=p.getAttribute("data-idpignore")==="1"):g.appendChild(s)),u=_qs(".isp_content",t),y=_qs(".isp_clk_cntr",u),u&&(w=_qs(".isp_title",u),w&&y&&(w.textContent=r.title,nt=w.closest("a"),nt&&(nt.href=r.imgUrl||"#"),tt=y.closest("a"),tt&&(tt.href=r.imgUrl||"#"),y.onclick=function(){c("ContainerClick")}),b=_qs(".isp_domain",u),b&&r.domain&&(b.textContent=r.domain,it=b.closest("a"),it&&(it.href=r.domainUrl||"#"),l=_qs(".isp_domfav",u),l&&r.domainFid?(rt=l.dataset.src,rt&&(l.src=rt.replace("%FAVID%",encodeURIComponent(r.domainFid)))):l&&(l.style.display="none")),k=_qs(".act_enlarge, .act_exp",u),k&&(k.href=r===null||r===void 0?void 0:r.imgUrl,k.onclick=function(n){sj_sp(n);c("EnlargeAction")}),a=_qs(".act_vs",u),a&&(a.href=hi(r,11),a.target="_blank",a.setAttribute("data-idpignore","1"),a.onclick=function(n){sj_sp(n);c("VisualSearchAction")})),sj_be(t,f,ut),sj_be(t,v,ft),sj_be(t,ht,wt),t.setAttribute("id",t.dataset.hcid),t.removeAttribute("data-hcid"),t.classList.remove("isp_hide"),n.appendChild(t),sj_evt.fire("SmartPreview.ContainerCreated",t,r),bt(t,"isp_fade",!1),st=u.offsetHeight,y.style.height="".concat(st,"px"),d&&sj_evt.fire("SerpIFrame.BindClick",".b_isp a:not(.act_vs)","href",null,!0,!0),h&&h.getKapiData({w:o.width,h:o.height,url:r.thurl,istk:r.istk,src:r.istk?"BingImageIndex":"Url"},oi))}function hi(n,t){var i="/images/search?view=detailV2";return i+="&id="+encodeURIComponent((n===null||n===void 0?void 0:n.mid)||""),i+="&mediaurl="+encodeURIComponent((n===null||n===void 0?void 0:n.murl)||""),i+="&sim="+t,i+="&q=imgurl:"+((n===null||n===void 0?void 0:n.murl)||""),i+="&vsimg="+encodeURIComponent((n===null||n===void 0?void 0:n.murl)||""),i+="&insightsToken="+encodeURIComponent((n===null||n===void 0?void 0:n.istk)||""),i+"&iss=SBI&vt=3&form=HVRSIM"}function ci(){sj_evt.fire("SmartPreview.init");sj_evt.bind(at,l);sj_be(_w,st,l);sj_be(_w,ct,a);sj_be(_w,lt,a)}function bt(n,t,i){n&&t&&requestAnimationFrame(function(){return requestAnimationFrame(function(){n.classList.toggle(t,i)})})}var ot="mouseenter",f="mouseleave",st="unload",ht="click",ct="scroll",lt="wheel",at="ajax.unload",kt="focus",v="focusout",y="mmisp",e="px",vt=8,p="SmartPreview",dt="Click",gt="Hover",w="Info",ni="EventType",s="Text",ti=/^ID=([^,]+),([0-9\.]+)$/,ii="data-nohov",r={},i,t,b,k,d,g,nt,ri=!1,h;n.log=u;n.logError=tt;n.registerConfig=pt;n.reRegisterConfig=fi;ci()})(SmartPreview||(SmartPreview={}))